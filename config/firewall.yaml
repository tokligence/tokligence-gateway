# Tokligence Gateway Prompt Firewall Configuration
#
# This firewall protects against PII leakage and sensitive data exposure
# in both user prompts (input) and LLM responses (output).
#
# Modes:
#   - monitor:  Log violations but allow requests through
#   - enforce:  Block requests that violate policies
#   - disabled: Firewall completely disabled
#
enabled: true
mode: monitor  # Start in monitor mode to test without blocking

# Input filters (applied to user prompts before sending to LLM)
input_filters:
  # Built-in PII regex filter (fast, no external dependencies)
  - type: pii_regex
    name: input_pii_basic
    priority: 10
    enabled: true
    config:
      redact_enabled: false  # Just detect, don't redact in monitor mode
      enabled_types:
        - EMAIL
        - PHONE
        - SSN
        - CREDIT_CARD
        - IP_ADDRESS
      confidence_threshold: 0.8

  # External Presidio service (optional, high accuracy)
  - type: http
    name: presidio_input
    priority: 20
    enabled: false  # Disabled by default, enable after starting Presidio
    config:
      endpoint: http://localhost:7317/v1/filter/input
      timeout_ms: 500
      on_error: allow  # Graceful degradation if Presidio is down

# Output filters (applied to LLM responses before returning to user)
output_filters:
  # Built-in PII regex filter for responses
  - type: pii_regex
    name: output_pii_basic
    priority: 10
    enabled: true
    config:
      redact_enabled: false  # Just detect in monitor mode
      enabled_types:
        - EMAIL
        - PHONE
        - SSN
        - CREDIT_CARD
      confidence_threshold: 0.8

# Global policies
policies:
  # Automatically redact detected PII (overrides filter-level redact_enabled)
  redact_pii: false  # Disabled in monitor mode

  # Maximum number of PII entities allowed before blocking (enforce mode only)
  max_pii_entities: 3

  # Log all firewall decisions
  log_decisions: true
