# ==============================================================================
# Tokligence Gateway Prompt Firewall Configuration
# ==============================================================================
# The firewall protects against sensitive data leakage in both user prompts
# (input) and LLM responses (output).
#
# Sensitive Data (SD) includes:
#   - Email addresses, phone numbers, physical addresses
#   - National IDs (SSN, Chinese ID, passport numbers)
#   - Financial data (credit cards, bank accounts)
#   - API keys, secrets, passwords, private keys
#   - Crypto addresses, medical IDs, tax IDs
#
# Configuration Hierarchy (priority from high to low):
# 1. Environment variables (e.g., TOKLIGENCE_PROMPT_FIREWALL_MODE)
#    - Highest priority, overrides everything
# 2. This firewall.ini file
#    - Main firewall configuration
# 3. Default values in code
#    - Lowest priority, used when no override is specified
#
# Modes:
#   - disabled: Firewall completely disabled (default in code)
#   - redact:   Detect SD -> Replace with tokens -> Restore in responses (RECOMMENDED)
#   - monitor:  Log violations but allow requests through (for testing)
#   - enforce:  Block requests that violate policies (strict mode)
#
# Environment variable overrides:
#   TOKLIGENCE_PROMPT_FIREWALL_MODE=redact|monitor|enforce|disabled
#   TOKLIGENCE_PROMPT_FIREWALL_ENABLED=true|false
#   TOKLIGENCE_PROMPT_FIREWALL_CONFIG=path/to/firewall.ini
# ==============================================================================

[prompt_firewall]
enabled = true
mode = redact

# SD patterns configuration file
pii_patterns_file = config/pii_patterns.ini

# Enabled regions (comma-separated)
# Available: global, us, cn, eu, uk, ca, au, in, jp, de, fr, sg
pii_regions = global,us,cn

# Minimum confidence threshold (0.0-1.0)
pii_min_confidence = 0.75

# Log all firewall decisions (useful for debugging)
log_decisions = true

# Log sensitive values in debug mode (WARNING: disable in production)
log_pii_values = false

# Maximum SD entities in a single request (soft limit, logs warning if exceeded)
max_pii_entities = 50

# ==============================================================================
# SSE Streaming Configuration (for redact mode)
# ==============================================================================
# redact_sse_buffer_timeout_ms = 500
# redact_sse_max_buffer_length = 30

# ==============================================================================
# Tokenizer Configuration (for redact mode)
# ==============================================================================
[tokenizer]
store_type = memory
ttl = 1h

# Redis configuration (only used if store_type = redis)
# redis_addr = localhost:6379
# redis_password =
# redis_db = 0
# redis_key_prefix = firewall:tokens

# ==============================================================================
# Input Filters (applied to user prompts before sending to LLM)
# ==============================================================================
[firewall_input_filters]

# Built-in Sensitive Data regex filter (fast, no external dependencies)
# Detects: EMAIL, PHONE, SSN, CREDIT_CARD, API_KEY, CRYPTO_ADDRESS, etc.
filter_sd_regex_enabled = true
filter_sd_regex_priority = 10

# External HTTP filter (for external scanning services)
# Can be used with Tokligence Guard, Presidio, or other scanning APIs
# Example: Tokligence Guard Protection Engine
#   filter_http_endpoint = https://us.guard.tokligence.ai:7316/v1/filter/input
#   filter_http_header_X-API-Key = tok_your_api_key_here
filter_http_enabled = true
filter_http_priority = 20
filter_http_endpoint = http://localhost:7317/v1/filter/input
filter_http_timeout_ms = 5000
filter_http_on_error = allow
# Custom headers for authentication (uncomment and set your API key)
# filter_http_header_X-API-Key = tok_your_api_key_here
# filter_http_header_Authorization = Bearer your_token_here

# ==============================================================================
# Output Filters (applied to LLM responses before returning to user)
# ==============================================================================
[firewall_output_filters]

# Built-in Sensitive Data regex filter for detokenization
filter_sd_regex_enabled = true
filter_sd_regex_priority = 10

# External HTTP filter (output scanning)
# NOTE: Disabled in redact mode because it re-redacts the output
# which conflicts with detokenization. Enable only in monitor/enforce modes.
filter_http_enabled = false
filter_http_priority = 20
filter_http_endpoint = http://localhost:7317/v1/filter/output
filter_http_timeout_ms = 5000
filter_http_on_error = allow
